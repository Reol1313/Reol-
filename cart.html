<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="../js/1.js"></script>
  <!-- elementplus中样式文件 -->
  <link rel="stylesheet" href="../js/index.css">
  <!-- elmentplus中的js文件 -->
  <script src="../js/index.full.js"></script>
  <!-- 引入ElementPlus中的图标文件 -->
  <script src="../js/index.life.min.js"></script>
  <!-- 引入axios.js文件 -->
  <script src="../js/axios.js"></script>
  <link rel="stylesheet" href="./个人信息.css">
</head>
<style>
  *{
    margin: 0;
  }
  .XKbutton{
    margin-top:  20px;
    margin-left: 20px;
  }
  .div{
    border-width: 95%;
    height: 50px;
    /* background-color: #ff7d7d; */
  }
  .div,p{
    font-size: 35px;
    font-weight: bold;
    text-align: center;
    /* color: red; */
  }
  .title{
    font-size: 30px;
    font-weight: bold;
    text-align: center;
    color: black;
  }

  /* header */
  
/* 头部 */
ul.nav{
    margin: 0 auto;
    display: flex;
}
ul.nav li{
    flex: 1;
    width: 100px;
    list-style: none;
    padding: 10px;
    text-align: center;
    line-height: 35px;

}
ul.nav li a{
    font-weight: bold;
    font-size: 20px;
    text-decoration: none;
    padding:10px; ;
    color:rgb(255, 255, 255);
    box-sizing: border-box;
}
ul.nav li a:hover,ul.nav li a.current{
    color: #007cc4;
    border-radius: 5px;
    background: #ffffff;
}

#TITLEO{
    height: 940px;
    background-color: rgb(255, 255, 255);
}
.TITLE_LINK{
    position: absolute;
    left: 700px;
    top: 30px;
}
.DIV_SPAN{
    font-size: 25px;
    font-weight: bold;
}
/* 头部css */
    .TITLET{
    position: relative;
    height: 100px;
    /* padding-top: 10px; */
    
	  background-position: center;
    background-image: url(./img/276231e9da17865.jpg);
    /* background: linear-gradient(to bottom, rgba(107, 175, 240, 0.5), rgb(129, 129, 129)); */
    /* box-shadow: 2px 5px  5px black; */
    }
    #el-collapse-head-0{
        color: #007cc4;
        font-weight: bold;
        font-size: 20px;
      }
      #el-collapse-head-1{
        color: #007cc4;
        font-weight: bold;
        font-size: 20px;
      }
      #el-collapse-head-2{
        color: #007cc4;
        font-weight: bold;
        font-size: 20px;
      }
      #el-collapse-head-3{
        color: #007cc4;
        font-weight: bold;
        font-size: 20px;
      }
      .T1{
        position: absolute;
        top: 20px;
        left: 20px;
        font-weight: bold;
        font-size: 45px;
        /* width: 400px; */
        display: block;
        color: aliceblue;
        text-shadow: 2px 2px 5px rgb(201, 72, 72);
      }
      .T2{
        position: absolute;
        left: 160px;
        top: 40px;
        text-shadow: 2px 2px 5px rgb(201, 72, 72);
        font-weight: bold;
        font-size: 20px;
        color: aliceblue;
        /* width: 400px; */
        display: block;
      }


      /* 轮播图 */
      /* 轮播图 */
    .demonstration {
        color: var(--el-text-color-secondary);
        }
    
        .el-carousel__item h3 {
        color: #475669;
        opacity: 0.75;
        line-height: 200px;
        margin: 0;
        text-align: center;
        }
    
        .el-carousel__item:nth-child(2n) {
        background-color: #99a9bf;
        }
    
        .el-carousel__item:nth-child(2n + 1) {
        background-color: #d3dce6;
        }

    
</style>
<body>
  <!-- header部分-->
  <div class="row" id="TITLEO">
                
    <div class="col-md-12 TITLET" >

      <span class="T1">宜购网</span>
      <span class="T2">Shopping center</span>
      

      <div class="TITLE_LINK">
        <ul class="nav">
          <li><a href="./欢迎页面.html" >网站首页</a></li>
          <li><a href="./18-商品管理.html" >商品页面</a></li>
          <li><a href="./cart.html">购物车</a></li>
          <li><a href="./个人信息主页.html">我的信息</a></li>
          <li><a href="">关于其他</a></li>
          <li><a href="./客服.html">联系客服</a></li>
      </ul>  
      </div>
     
  </div>
  <!-- 主体部分 -->
  <div class="div">
    <p>我的购物车</p>
  </div>
  <div id="app">
    <el-table align="center" :data="goodsData" style="width: 100%">
      <el-table-column align="center" property="goods_id" label="商品id"></el-table-column>
      <el-table-column align="center" property="current_price" label="当前价格"></el-table-column>
      <el-table-column align="center" property="cart_number" label="数量"></el-table-column>
      <el-table-column align="center" label="商品图片">
        <template #default="scope">
          <img width="100px" height="100px" :src="scope.row.img_small_logo" alt="">
        </template>
      </el-table-column>
      <el-table-column align="center" property="current_price" label="价格"></el-table-column>
      <el-table-column align="center" property="title" label="商品标题"></el-table-column>

      <el-table-column align="center" fixed="right" label="操作">
        <template #default="scope">
          <el-button type="danger" size="small" @click="delCart(scope.row.goods_id)">删除商品</el-button>
        </template>
      </el-table-column>
    </el-table>
    <el-button @click="clearCart" type="primary" class="XKbutton" >清空购物车</el-button>
		<div class="main">
			<p class="title">类似商品</p>   
		</div>
  </div>


  <!-- 猜您喜欢 -->
  <br>
  <div class="CONTENT2">
      <div class="CON_TITLE">
         
        </div>

          <!-- 主体 -->

      <div class="container">
        <div class="card" id="OneImg">
            <div class="content">
                <h2>店铺活动¥9.9起</h2>
                <p>蓝莓岩烧吐司面包厚切肉松乳酪早餐面包欧包整箱代餐健康零食品</p>
                <button>查看更多</button>
            </div>
        </div>
        <div class="card" id="TwoImg">
            <div class="content">
                <h2>掌柜推荐¥119.9</h2>
                <p>优形鸡胸肉开袋即食低脂速食鸡肉零食高蛋白轻食鸡肉食品饱腹代餐</p>
                <button>查看更多</button>
            </div>
        </div>
        <div class="card">
            <div class="content">
                <h2>¥3758起</h2>
                <p>Apple/苹果 AirPods Max 头戴降噪耳机 airpodsmax 掌柜推荐</p>
                <button>查看更多</button>
            </div>
        </div>
        <div class="card">
            <div class="content">
                <h2>新品促销¥119.6起</h2>
                <p>葵珍洽洽恰恰内蒙原味大瓜子河套特产葵花籽炒货零食188g 掌柜推荐</p>
                <button>查看更多</button>
            </div>
        </div>
        <div class="card">
            <div class="content">
                <h2>新品促销 ¥42.8起</h2>
                <p>超Q方便面 泡面整箱 混搭老坛酸菜 红烧牛肉面 速食夜宵即速食干脆面</p>
                <button>查看更多</button>
            </div>
        </div>
        <div class="card">
          <div class="content">
              <h2>新品促销¥78.8起</h2>
              <p>OGORUS无线鼠标 蓝牙静音笔记本电脑游戏电竞可充电宏编程无限滑鼠 掌柜推荐</p>
              <button>查看更多</button>
          </div>
      </div>
      <div class="card">
        <div class="content">
            <h2>新品抢购¥209起</h2>
            <p>zbt免插卡随身wifi无线移动wi-fi 三网切换全国通用千兆网络 4g路由器</p>
            <button>查看更多</button>
        </div>
    </div>
        
      </div>
  
      

  </div>

  <script>
          // 引入Element Plus的消息提示组件
 // 创建一个Vue应用
 // 定义数据
// 商品数据数组
 // 总价
    const { ElMessage } = ElementPlus
    const app = Vue.createApp({
      data() {
        return {
          goodsData: [],
          allprice: 0
        }
      },
      // 自定义的方法
      // 获取行键值
 // 修改元素的选中状态
        // 遍历事件数组
           // 打印商品ID和选中状态
            // 获取商品ID
            // 根据选中状态设置type值
            // 从localStorage中获取用户ID和token
           // 构造请求数据
            // 保存当前上下文
            // 同时发送两个请求

              // 发送POST请求，修改购物车商品的选中状态
              // 设置请求头
              // 发送GET请求，获取购物车商品列表
                // 设置请求头
             // 处理响应结果
                // 打印选中状态的响应结果
                // 获取购物车商品列表
                 // 更新商品数据数组
                 // 打印购物车商品列表
                // 遍历购物车商品列表
                  // 如果商品被选中
                    // 计算总价
      methods: {
        getRowKeys(row) {
          console.log(row.userId)
        },
        handleSelectionChange(events) {
          console.log(events)
          for (var i = 0; i < events.length; i++) {
            console.log(events[i].goods_id, events[i].is_select)
            var goods_id = events[i].goods_id
            var type = events[i].is_select === false ? 1 : 0
            const { userid, token } = localStorage
            const data = { id: userid, type: type }
            var that = this
            axios.all([

              axios.post("http://localhost:8888/cart/select/all", data, {
                headers: { "Content-Type": 'application/x-www-form-urlencoded', "authorization": token }
              }),
              axios.get("http://localhost:8888/cart/list?id=" + userid, {
                headers: { "authorization": token }
              })
            ])
              .then(axios.spread(function (selectResult, cartResult) {
                console.log(selectResult)
                var cartList = cartResult.data.cart
                that.goodsData = cartList
                console.log(cartList)
                for (var i = 0; i < cartList.length; i++) {
                  if (cartList[i].is_select) {
                    that.allprice = that.allprice + cartList[i].current_price * cartList[i].cart_number

                  }

                }

              }));
          }

        },
        // 查询购物车商品
         // 查询购物车商品方法
         // 保存当前上下文
           // 从localStorage中获取用户ID和token
          // 打印用户ID
          // 发送GET请求，获取购物车商品列表
            // 设置请求头
           // 处理响应结果
           // 打印响应结果
           // 更新商品数据数组
        selectCart() {
          var that = this
          const { userid, token } = localStorage
          console.log(userid)
          axios.get("http://localhost:8888/cart/list?id=" + userid, {
            headers: { "authorization": token }
          }).then(function (res) {
            console.log(res)
            that.goodsData = res.data.cart
          })
        },
        // 删除商品
        // 删除商品方法
        //  打印商品ID
          //  保存当前上下文
        //  从localStorage中获取用户ID和token
          // 打印用户ID
        //  发送GET请求，删除指定商品
            // 设置请求头
          // 处理响应结果
            // 打印响应结果
            // 如果删除成功
              // 显示成功消息提示
              // 重新查询购物车商品列表
        delCart(goods_id) {
          console.log(goods_id)
          var that = this
          const { userid, token } = localStorage
          console.log(userid)
          axios.get("http://localhost:8888/cart/remove?id=" + userid + "&goodsId=" + goods_id, {
            headers: { "authorization": token }
          }).then(function (res) {
            console.log(res)
            if (res.data.code == 1) {
              ElMessage.success(res.data.message)
              that.selectCart()
            }
          })
        },
        // 清空购物车
        // 清空购物车方法
         // 保存当前上下文
         // 从localStorage中获取用户ID和token
          // 打印用户ID
          // 发送GET请求，清空购物车
           // 设置请求头
          // 处理响应结果
          // 打印响应结果
           // 如果清空成功
              // 显示成功消息提示
             // 重新查询购物车商品列表
        clearCart() {
          var that = this
          const { userid, token } = localStorage
          console.log(userid)
          axios.get("http://localhost:8888/cart/clear?id=" + userid, {
            headers: { "authorization": token }
          }).then(function (res) {
            console.log(res)
            if (res.data.code == 1) {
              ElMessage.success(res.data.message)
              that.selectCart()
            }
          })
        }
      },
      //预加载函数： 一进入该页面就执行该方法
      // 页面加载完成后执行的方法
  //  查询购物车商品列表
//  使用Element Plus组件库
//   注册Element Plus的购物车图标组件
// // 挂载Vue应用到指定的DOM元素上
      mounted() {
        this.selectCart()
      }
    })
    app.use(ElementPlus)
    app.component('shoppingcartfull', ElementPlusIconsVue.ShoppingCartFull)
    app.mount("#app")
  </script>
</body>
</html>